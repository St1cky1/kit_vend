# Kit Vend - Vending Machine Management System

## üìã –û–ø–∏—Å–∞–Ω–∏–µ –ø—Ä–æ–µ–∫—Ç–∞

**Kit Vend** ‚Äî —ç—Ç–æ –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å –¥–ª—è —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è —Ç–æ—Ä–≥–æ–≤—ã–º–∏ –∞–≤—Ç–æ–º–∞—Ç–∞–º–∏ —Å –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏–µ–π –≤ API Kit Vending. –ü—Ä–æ–µ–∫—Ç —Ä–µ–∞–ª–∏–∑—É–µ—Ç Clean Architecture —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π –∫–∞–∫ gRPC, —Ç–∞–∫ –∏ REST API —á–µ—Ä–µ–∑ gRPC Gateway.

## üèóÔ∏è –ê—Ä—Ö–∏—Ç–µ–∫—Ç—É—Ä–∞

–ü—Ä–æ–µ–∫—Ç —Å–ª–µ–¥—É–µ—Ç **Clean Architecture** –ø—Ä–∏–Ω—Ü–∏–ø–∞–º:

1. **Entity Layer** (`internal/entity/`) ‚Äî –Ω–µ–∑–∞–≤–∏—Å–∏–º—ã–µ –±–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ –∏ –∫–æ–¥—ã –æ—à–∏–±–æ–∫
2. **Use Case Layer** (`internal/usecase/`) ‚Äî –±–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞ –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
3. **Interface Adapter Layer** (`internal/handler/`, `internal/grpc/`) ‚Äî HTTP/gRPC –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏
4. **Framework & Driver Layer** (`cmd/server/`) ‚Äî entry point –∏ –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–æ–≤

## üìÅ –°—Ç—Ä—É–∫—Ç—É—Ä–∞ –ø—Ä–æ–µ–∫—Ç–∞

```
kit_vend/
‚îú‚îÄ‚îÄ pb/v1/                               # Protocol Buffers (—Å–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∫–æ–¥)
‚îÇ   ‚îú‚îÄ‚îÄ vending_machine.proto.proto      # gRPC —Å–µ—Ä–≤–∏—Å –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ vending_machine.pb.go            # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π protobuf –∫–æ–¥
‚îÇ   ‚îú‚îÄ‚îÄ vending_machine_grpc.pb.go       # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π gRPC –∫–æ–¥
‚îÇ   ‚îî‚îÄ‚îÄ vending_machine.pb.gw.go         # –°–≥–µ–Ω–µ—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π REST gateway –∫–æ–¥
‚îú‚îÄ‚îÄ cmd/
‚îÇ   ‚îî‚îÄ‚îÄ server/
‚îÇ       ‚îî‚îÄ‚îÄ main.go                      # Entry point –ø—Ä–∏–ª–æ–∂–µ–Ω–∏—è
‚îú‚îÄ‚îÄ internal/
‚îÇ   ‚îú‚îÄ‚îÄ api/                             # Kit Vending API –∏–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ client.go                    # REST –∫–ª–∏–µ–Ω—Ç –¥–ª—è Kit Vending API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ models.go                    # –°—Ç—Ä—É–∫—Ç—É—Ä—ã –¥–∞–Ω–Ω—ã—Ö API
‚îÇ   ‚îú‚îÄ‚îÄ entity/                          # –ë–∏–∑–Ω–µ—Å-—Å—É—â–Ω–æ—Å—Ç–∏ (Domain layer)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ errors.go                    # 24 –∫–æ–¥–∞ –æ—à–∏–±–æ–∫ API
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vending_machine.go           # –î–æ–º–µ–Ω–Ω—ã–µ –º–æ–¥–µ–ª–∏
‚îÇ   ‚îú‚îÄ‚îÄ grpc/                            # gRPC —Å–µ—Ä–≤–µ—Ä
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ vending_machine_service.go   # gRPC —Å–µ—Ä–≤–∏—Å —Ä–µ–∞–ª–∏–∑–∞—Ü–∏—è
‚îÇ   ‚îú‚îÄ‚îÄ handler/                         # HTTP –æ–±—Ä–∞–±–æ—Ç—á–∏–∫–∏ (REST API)
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ http.go                      # REST endpoints
‚îÇ   ‚îú‚îÄ‚îÄ storage/                         # Repository pattern (Data Access)
‚îÇ   ‚îÇ   ‚îú‚îÄ‚îÄ repository.go                # –ò–Ω—Ç–µ—Ä—Ñ–µ–π—Å—ã —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–µ–≤
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ mock.go                      # Mock —Ä–µ–∞–ª–∏–∑–∞—Ü–∏–∏ –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îÇ   ‚îî‚îÄ‚îÄ usecase/                         # Application layer
‚îÇ       ‚îî‚îÄ‚îÄ vending_machine.go           # –ë–∏–∑–Ω–µ—Å-–ª–æ–≥–∏–∫–∞
‚îú‚îÄ‚îÄ pkg/                                 # Shared packages
‚îÇ   ‚îú‚îÄ‚îÄ config/
‚îÇ   ‚îÇ   ‚îî‚îÄ‚îÄ config.go                    # –ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è
‚îÇ   ‚îî‚îÄ‚îÄ logger/
‚îÇ       ‚îî‚îÄ‚îÄ logger.go                    # –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω–æ–µ –ª–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ (slog)
‚îú‚îÄ‚îÄ Makefile                             # –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ docker-compose.yaml                  # PostgreSQL –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îú‚îÄ‚îÄ go.mod                               # Go –º–æ–¥—É–ª–∏ –∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏
‚îú‚îÄ‚îÄ go.sum                               # –•–µ—à–∏ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
‚îú‚îÄ‚îÄ CLAUDE.md                            # –î–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
‚îî‚îÄ‚îÄ README.md                            # –û—Å–Ω–æ–≤–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è
```

## üîß –¢–µ—Ö–Ω–æ–ª–æ–≥–∏—á–µ—Å–∫–∏–π —Å—Ç–µ–∫

### –Ø–∑—ã–∫–∏ –∏ —Ñ—Ä–µ–π–º–≤–æ—Ä–∫–∏
- **Go 1.25.4** ‚Äî –æ—Å–Ω–æ–≤–Ω–æ–π —è–∑—ã–∫
- **gRPC** ‚Äî –º–∏–∫—Ä–æ—Å–µ—Ä–≤–∏—Å–Ω—ã–µ –∫–æ–º–º—É–Ω–∏–∫–∞—Ü–∏–∏
- **gRPC Gateway** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–µ–æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–µ gRPC –≤ REST
- **Chi** ‚Äî –ª–µ–≥–∫–æ–≤–µ—Å–Ω—ã–π HTTP —Ä–æ—É—Ç–µ—Ä

### –ó–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏ (go.mod)
```
github.com/go-chi/chi/v5 v5.2.3
github.com/grpc-ecosystem/grpc-gateway/v2 v2.27.3
google.golang.org/genproto/googleapis/api v0.0.0-20251202230838-ff82c1b0f217
google.golang.org/grpc v1.77.0
google.golang.org/protobuf v1.36.10
```

### –ò–Ω—Ñ—Ä–∞—Å—Ç—Ä—É–∫—Ç—É—Ä–∞
- **PostgreSQL 18.0** ‚Äî –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö (Docker Compose)
- **Docker Compose** ‚Äî –ª–æ–∫–∞–ª—å–Ω–∞—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∞

### –ò–Ω—Å—Ç—Ä—É–º–µ–Ω—Ç—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- **Make** ‚Äî –∞–≤—Ç–æ–º–∞—Ç–∏–∑–∞—Ü–∏—è –∫–æ–º–∞–Ω–¥
- **golangci-lint** ‚Äî —Å—Ç–∞—Ç–∏—á–µ—Å–∫–∏–π –∞–Ω–∞–ª–∏–∑ –∫–æ–¥–∞
- **gofmt** ‚Äî —Ñ–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
- **Protocol Buffers** ‚Äî –æ–ø—Ä–µ–¥–µ–ª–µ–Ω–∏–µ —Å—Ö–µ–º –∏ —Å–µ—Ä–≤–∏—Å–æ–≤

## üöÄ –ö–æ–º–∞–Ω–¥—ã –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏

### –û—Å–Ω–æ–≤–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã

```bash
# Development —Ä–µ–∂–∏–º (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏–π –ø–µ—Ä–µ–∑–∞–ø—É—Å–∫)
make dev

# Build –∏ –∑–∞–ø—É—Å–∫
make build && make run

# –ì–µ–Ω–µ—Ä–∞—Ü–∏—è gRPC –∫–æ–¥–∞ –∏–∑ proto —Ñ–∞–π–ª–æ–≤
make proto

# –§–æ—Ä–º–∞—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –∫–æ–¥–∞
make fmt

# –ó–∞–ø—É—Å–∫ —Ç–µ—Å—Ç–æ–≤
make test

# –û—á–∏—Å—Ç–∫–∞ –∞—Ä—Ç–µ—Ñ–∞–∫—Ç–æ–≤ (bin/, go clean)
make clean

# –ü—Ä–æ–≤–µ—Ä–∫–∞ –∫–æ–¥–∞ (linter)
make lint

# –£–ø–æ—Ä—è–¥–æ—á–∏–≤–∞–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–µ–π
make mod-tidy
```

## üîå –ü–æ—Ä—Ç—ã

| –°–µ—Ä–≤–∏—Å | –ü–æ—Ä—Ç | –ü–µ—Ä–µ–º–µ–Ω–Ω–∞—è |
|--------|------|-----------|
| HTTP REST API | 8080 | `SERVER_PORT` |
| gRPC —Å–µ—Ä–≤–µ—Ä | 50051 | –∂–µ—Å—Ç–∫–æ –∑–∞–¥–∞–Ω |

## üåç –ü–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –æ–∫—Ä—É–∂–µ–Ω–∏—è

```env
# –°–µ—Ä–≤–µ—Ä
SERVER_PORT=8080
LOG_LEVEL=info

# –ë–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö
DB_HOST=localhost
DB_PORT=5432
DB_USER=postgres
DB_PASSWORD=password
DB_NAME=kit_vend

# Kit Vending API
KIT_COMPANY_ID=380649
KIT_LOGIN=demotest
KIT_PASSWORD=vendor734102
```

## ‚úÖ –†–µ–∞–ª–∏–∑–æ–≤–∞–Ω–Ω—ã–µ API –º–µ—Ç–æ–¥—ã

–ò–Ω—Ç–µ–≥—Ä–∞—Ü–∏—è —Å Kit Vending API –≤–∫–ª—é—á–∞–µ—Ç —Å–ª–µ–¥—É—é—â–∏–µ –º–µ—Ç–æ–¥—ã:

| –ú–µ—Ç–æ–¥ | –û–ø–∏—Å–∞–Ω–∏–µ | –°—Ç–∞—Ç—É—Å |
|-------|---------|--------|
| 4 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ | ‚úÖ |
| 5 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ –ø–æ ID | ‚úÖ |
| 6 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –ø—Ä–æ–¥–∞–∂ | ‚úÖ |
| 8 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ –æ–±—Å–ª—É–∂–∏–≤–∞–Ω–∏–π –∏ –∑–∞–≥—Ä—É–∑–æ–∫ | ‚úÖ |
| 9 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ—Å—Ç–æ—è–Ω–∏–π —Ç–æ—Ä–≥–æ–≤—ã—Ö –∞–≤—Ç–æ–º–∞—Ç–æ–≤ | ‚úÖ |
| 11 | –ü–æ–ª—É—á–µ–Ω–∏–µ —Å–ø–∏—Å–∫–∞ —Å–æ–±—ã—Ç–∏–π | ‚úÖ |
| 13 | –û—Ç–ø—Ä–∞–≤–∫–∞ –∫–æ–º–∞–Ω–¥—ã —Ç–æ—Ä–≥–æ–≤–æ–º—É –∞–≤—Ç–æ–º–∞—Ç—É | ‚úÖ |
| 34 | –ó–∞–ø—Ä–æ—Å –æ—Å—Ç–∞—Ç–∫–æ–≤ –¢–ê | ‚úÖ |

## üî¥ –ö–æ–¥—ã –æ—à–∏–±–æ–∫ API

–†–µ–∞–ª–∏–∑–æ–≤–∞–Ω—ã –≤—Å–µ **24 –∫–æ–¥–∞ –æ—à–∏–±–æ–∫** –∏–∑ –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏–∏ Kit Vending API –≤ `internal/entity/errors.go`:

- `ResultCodeSuccess = 0` ‚Äî –£—Å–ø–µ—Ö
- `ResultCodeUnknownError = 1` ‚Äî –ù–µ–∏–∑–≤–µ—Å—Ç–Ω–∞—è –æ—à–∏–±–∫–∞
- `ResultCodeInvalidJSON = 2` ‚Äî –ù–µ–∫–æ—Ä—Ä–µ–∫—Ç–Ω—ã–π JSON
- ... –∏ —Ç.–¥. –¥–æ –∫–æ–¥–∞ 23

## üß™ –¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ API

### cURL
```bash
curl http://localhost:8080/api/v1/health
```

### gRPC (—Ç—Ä–µ–±—É–µ—Ç grpcurl)
```bash
# –£—Å—Ç–∞–Ω–æ–≤–∫–∞ grpcurl
go install github.com/fullstorytech/grpcurl/cmd/grpcurl@latest

# –°–ø–∏—Å–æ–∫ —Å–µ—Ä–≤–∏—Å–æ–≤
grpcurl -plaintext localhost:50051 list

# –í—ã–∑–æ–≤ –º–µ—Ç–æ–¥–∞
grpcurl -plaintext -d '{}' localhost:50051 vending.VendingMachineService/GetMachines
```

## üìù –î–æ–±–∞–≤–ª–µ–Ω–∏–µ –Ω–æ–≤—ã—Ö –º–µ—Ç–æ–¥–æ–≤ API

1. –î–æ–±–∞–≤—å—Ç–µ RPC –º–µ—Ç–æ–¥ –≤ `pb/v1/vending_machine.proto`
2. –î–æ–±–∞–≤—å—Ç–µ —Å–æ–æ–±—â–µ–Ω–∏—è Request/Response –≤ proto —Ñ–∞–π–ª
3. –ó–∞–ø—É—Å—Ç–∏—Ç–µ `make proto` –¥–ª—è –∞–≤—Ç–æ–≥–µ–Ω–µ—Ä–∞—Ü–∏–∏ –∫–æ–¥–∞
4. –†–µ–∞–ª–∏–∑—É–π—Ç–µ –º–µ—Ç–æ–¥ –≤ `internal/grpc/vending_machine_service.go`
5. –î–æ–±–∞–≤—å—Ç–µ handler –≤ `internal/handler/http.go` (–µ—Å–ª–∏ –Ω—É–∂–µ–Ω REST endpoint)
6. –†–µ–∞–ª–∏–∑—É–π—Ç–µ use case –≤ `internal/usecase/vending_machine.go`

## ‚ö†Ô∏è –í–∞–∂–Ω—ã–µ –∑–∞–º–µ—Ç–∫–∏

- **Mock —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–∏** –∏—Å–ø–æ–ª—å–∑—É—é—Ç—Å—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏. –í –ø—Ä–æ–¥–∞–∫—à–µ–Ω–µ –Ω—É–∂–Ω–æ —Ä–µ–∞–ª–∏–∑–æ–≤–∞—Ç—å —Ä–µ–∞–ª—å–Ω—ã–µ —Ö—Ä–∞–Ω–∏–ª–∏—â–∞ —Å PostgreSQL.
- **–õ–æ–≥–∏—Ä–æ–≤–∞–Ω–∏–µ** –∏—Å–ø–æ–ª—å–∑—É–µ—Ç –≤—Å—Ç—Ä–æ–µ–Ω–Ω—ã–π –ø–∞–∫–µ—Ç `log/slog` (Go 1.21+)
- **Chi —Ä–æ—É—Ç–µ—Ä** –ø–æ–¥–¥–µ—Ä–∂–∏–≤–∞–µ—Ç path –ø–∞—Ä–∞–º–µ—Ç—Ä—ã —á–µ—Ä–µ–∑ —Å–∏–Ω—Ç–∞–∫—Å–∏—Å `{id}`
- **Protocol Buffers** –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –≥–µ–Ω–µ—Ä–∏—Ä—É—é—Ç REST endpoints —á–µ—Ä–µ–∑ gRPC Gateway

## üê≥ Docker –∏ –±–∞–∑–∞ –¥–∞–Ω–Ω—ã—Ö

–î–ª—è –ª–æ–∫–∞–ª—å–Ω–æ–π —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏ –∏—Å–ø–æ–ª—å–∑—É–µ—Ç—Å—è Docker Compose —Å PostgreSQL:

```bash
# –ó–∞–ø—É—Å–∫ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose up -d

# –û—Å—Ç–∞–Ω–æ–≤–∫–∞ –±–∞–∑—ã –¥–∞–Ω–Ω—ã—Ö
docker-compose down
```

–ö–æ–Ω—Ñ–∏–≥—É—Ä–∞—Ü–∏—è –Ω–∞—Ö–æ–¥–∏—Ç—Å—è –≤ `docker-compose.yaml`, –ø–µ—Ä–µ–º–µ–Ω–Ω—ã–µ –±–µ—Ä—É—Ç—Å—è –∏–∑ –ø–µ—Ä–µ–º–µ–Ω–Ω—ã—Ö –æ–∫—Ä—É–∂–µ–Ω–∏—è.

## üìö –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ä–µ—Å—É—Ä—Å—ã

- `CLAUDE.md` ‚Äî —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω–∞—è –¥–æ–∫—É–º–µ–Ω—Ç–∞—Ü–∏—è –¥–ª—è —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
- `go.mod` –∏ `go.sum` ‚Äî —É–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç—è–º–∏
- `Makefile` ‚Äî –≤—Å–µ –¥–æ—Å—Ç—É–ø–Ω—ã–µ –∫–æ–º–∞–Ω–¥—ã —Ä–∞–∑—Ä–∞–±–æ—Ç–∫–∏
